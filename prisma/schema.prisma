generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model addresses {
  id           Int       @id @default(autoincrement())
  user_id      Int?
  full_name    String?   @db.VarChar
  phone        String?   @db.VarChar
  address_line String?   @db.VarChar
  city         String?   @db.VarChar
  province     String?   @db.VarChar
  postal_code  String?   @db.VarChar
  is_default   Boolean?  @default(false)
  created_at   DateTime? @db.Timestamp(6)
  users        users?    @relation(fields: [user_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  orders       orders[]
}

model brands {
  id          Int        @id @default(autoincrement())
  name        String?    @db.VarChar
  description String?
  created_at  DateTime?  @db.Timestamp(6)
  products    products[]
}

model cart_items {
  id         Int       @id @default(autoincrement())
  cart_id    Int?
  product_id Int?
  quantity   Int?
  created_at DateTime? @db.Timestamp(6)
  carts      carts?    @relation(fields: [cart_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  products   products? @relation(fields: [product_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
}

model carts {
  id         Int          @id @default(autoincrement())
  user_id    Int?
  created_at DateTime?    @db.Timestamp(6)
  updated_at DateTime?    @db.Timestamp(6)
  cart_items cart_items[]
  users      users?       @relation(fields: [user_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
}

model categories {
  id          Int        @id @default(autoincrement())
  name        String?    @db.VarChar
  description String?
  created_at  DateTime?  @db.Timestamp(6)
  products    products[]
}

model order_items {
  id              Int            @id @default(autoincrement())
  order_id        Int?
  product_id      Int?
  prescription_id Int?
  quantity        Int?
  price           Decimal?       @db.Decimal
  orders          orders?        @relation(fields: [order_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  prescriptions   prescriptions? @relation(fields: [prescription_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  products        products?      @relation(fields: [product_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
}

model orders {
  id             Int           @id @default(autoincrement())
  user_id        Int?
  address_id     Int?
  total_amount   Decimal?      @db.Decimal
  status         OrderStatus?  @default(Pending)
  payment_method String?       @db.VarChar
  created_at     DateTime?     @db.Timestamp(6)
  updated_at     DateTime?     @db.Timestamp(6)
  order_items    order_items[]
  addresses      addresses?    @relation(fields: [address_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  users          users?        @relation(fields: [user_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
}

model pharmacists {
  id            Int             @id @default(autoincrement())
  user_id       Int?
  license_no    String?         @unique @db.VarChar
  approved      Boolean?        @default(false)
  created_at    DateTime?       @db.Timestamp(6)
  users         users?          @relation(fields: [user_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  prescriptions prescriptions[]
}

model prescriptions {
  id            Int                 @id @default(autoincrement())
  user_id       Int?
  pharmacist_id Int?
  image_url     String?             @db.VarChar
  status        PrescriptionStatus? @default(Pending)
  refills_total Int?                @default(0)
  refills_used  Int?                @default(0)
  expiry_date   DateTime?           @db.Date
  remarks       String?
  created_at    DateTime?           @db.Timestamp(6)
  updated_at    DateTime?           @db.Timestamp(6)
  order_items   order_items[]
  pharmacists   pharmacists?        @relation(fields: [pharmacist_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  users         users?              @relation(fields: [user_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
}

model products {
  id                                                         Int                 @id @default(autoincrement())
  category_id                                                Int?
  brand_id                                                   Int?
  name                                                       String?             @db.VarChar
  description                                                String?
  price                                                      Decimal?            @db.Decimal
  dosage_info                                                String?             @db.VarChar
  requires_prescription                                      Boolean?            @default(false)
  stock                                                      Int?
  expiry_date                                                DateTime?           @db.Date
  is_active                                                  Boolean?            @default(true)
  created_at                                                 DateTime?           @db.Timestamp(6)
  updated_at                                                 DateTime?           @db.Timestamp(6)
  ai_consultations                                           ai_consultations[]
  cart_items                                                 cart_items[]
  interactionsAsA                                            drug_interactions[] @relation("RelationA")
  interactionsAsB                                            drug_interactions[] @relation("RelationB")
  order_items                                                order_items[]
  brands                                                     brands?             @relation(fields: [brand_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  categories                                                 categories?         @relation(fields: [category_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
}

model users {
  id                   Int                   @id @default(autoincrement())
  name                 String?               @db.VarChar
  email                String?               @unique @db.VarChar
  password             String?               @db.VarChar
  phone                String?               @db.VarChar
  role                 Role?                 @default(patient)
  loyalty_points       Int?                  @default(0)
  is_active            Boolean?              @default(true)
  created_at           DateTime?             @default(now()) @db.Timestamp(6)
  updated_at           DateTime?             @db.Timestamp(6)
  addresses            addresses[]
  ai_consultations     ai_consultations[]
  carts                carts[]
  orders               orders[]
  pharmacists          pharmacists[]
  prescriptions        prescriptions[]
  user_health_profiles user_health_profiles?
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model ai_consultations {
  id                   Int       @id @default(autoincrement())
  user_id              Int?
  symptoms_input       String?
  ai_analysis          String?
  suggested_product_id Int?
  created_at           DateTime? @default(now()) @db.Timestamp(6)
  products             products? @relation(fields: [suggested_product_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  users                users?    @relation(fields: [user_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model drug_interactions {
  id                                                Int       @id @default(autoincrement())
  product_id_a                                      Int?
  product_id_b                                      Int?
  severity                                          Severity?
  description                                       String?
  productA                                          products? @relation("RelationA", fields: [product_id_a], references: [id], onDelete: NoAction, onUpdate: NoAction)
  productB                                          products? @relation("RelationB", fields: [product_id_b], references: [id], onDelete: NoAction, onUpdate: NoAction)
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model user_health_profiles {
  user_id             Int       @id
  allergies           String?
  chronic_conditions  String?
  current_medications String?
  updated_at          DateTime? @db.Timestamp(6)
  users               users     @relation(fields: [user_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
}

enum PrescriptionStatus {
  Pending
  Approved
  Rejected
}

enum Role {
  patient
  pharmacist
  admin
}

enum Severity {
  Low
  Moderate
  Severe
}

enum OrderStatus {
  Pending
  Processing
  Shipped
  Delivered
  Cancelled
}
